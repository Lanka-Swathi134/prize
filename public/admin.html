<div id="dashboardSection" class="hidden max-w-6xl mx-auto">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12 border-b border-white/10 pb-8">
        <div>
            <h1 class="serif-font gold-accent text-5xl mb-2">Participant Registry</h1>
            <p class="text-white/40 uppercase tracking-[0.3em] text-[10px]">Department of Pathology | SMGR College</p>
        </div>
        <div class="flex gap-4 mt-6">
            <button onclick="clearData()" class="bg-red-900/40 hover:bg-red-600 text-white/70 px-6 py-3 rounded-xl transition text-[10px] font-bold border border-red-500/20">
                üóëÔ∏è CLEAR ALL
            </button>
            <button onclick="exportToExcel()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-8 py-3 rounded-xl font-bold transition flex items-center gap-2">
                üíæ EXPORT EXCEL
            </button>
            <button onclick="location.reload()" class="bg-white/5 hover:bg-white/10 text-white px-8 py-3 rounded-xl transition uppercase text-xs tracking-widest font-bold">Exit</button>
        </div>
    </div>

    <div class="glass-card rounded-[2rem] overflow-hidden shadow-2xl">
        <table class="w-full text-left">
            <thead class="bg-white/5 text-[#d4af37] text-[10px] uppercase font-bold tracking-widest">
                <tr>
                    <th class="p-6">Index</th>
                    <th class="p-6">Full Name</th>
                    <th class="p-6">Year & Section</th>
                    <th class="p-6">Phone Number</th>
                </tr>
            </thead>
            <tbody id="dataTable" class="divide-y divide-white/5 text-sm">
                </tbody>
        </table>
    </div>
</div>

<script>
    async function checkLogin() {
        const pass = document.getElementById('pass').value;
        const res = await fetch('/api/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username: 'admin', password: pass})
        });
        if (res.ok) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            loadData();
        } else { alert("Unauthorized Access"); }
    }

    async function loadData() {
        try {
            const res = await fetch('/api/admin/data');
            const data = await res.json();
            window.excelData = data;
            const table = document.getElementById('dataTable');
            
            if (data.length === 0) {
                table.innerHTML = `<tr><td colspan="4" class="p-20 text-center text-white/20 italic">No participants registered yet.</td></tr>`;
                return;
            }

            table.innerHTML = data.map((u, index) => `
                <tr class="transition-colors hover:bg-white/5">
                    <td class="p-6 text-white/30 font-mono text-xs">#${index + 1}</td>
                    <td class="p-6 font-semibold gold-accent uppercase tracking-wide">${u.name}</td>
                    <td class="p-6 text-white/70">${u.year || 'N/A'} ‚Äî ${u.section || 'N/A'}</td>
                    <td class="p-6 font-mono text-xs text-white/50">${u.phone || 'No Phone'}</td>
                </tr>
            `).join('');
        } catch (err) {
            console.error("Fetch error:", err);
        }
    }

    // New: Function to clear data for a fresh start
    async function clearData() {
        if (confirm("‚ö†Ô∏è Are you sure? This will delete all registrations permanently!")) {
            await fetch('/api/admin/clear', { method: 'POST' });
            loadData();
        }
    }

    function exportToExcel() {
        if (!window.excelData || window.excelData.length === 0) {
            alert("No data to export!");
            return;
        }
        const ws = XLSX.utils.json_to_sheet(window.excelData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Participants");
        XLSX.writeFile(wb, "LuckyDip_Registrations.xlsx");
    }
</script>
